# 🔒 売上管理システム セキュリティガイド

## 実装されたセキュリティ機能

### 1. ユーザー認証
- **Flask-Login**: セッションベース認証
- **パスワードハッシュ化**: Werkzeugによる安全なハッシュ化
- **3ユーザー管理**: manager, analyst, viewer

### 2. セッション管理
- **セキュアCookie**: HTTPSでのみ送信
- **HttpOnly**: JavaScriptからアクセス不可
- **SameSite**: CSRF攻撃対策

### 3. データ保護
- **認証必須API**: 全てのデータAPIに認証が必要
- **セッション確認**: 毎回のリクエストで認証状態をチェック
- **自動ログアウト**: セッション期限切れで自動ログアウト
- **データ集約**: 売上データはバックエンド（backend/data/）で一元管理

### 4. アクセス制御
- **ログイン画面**: 未認証時は自動的にログイン画面に誘導
- **認証チェック**: フロントエンド起動時に認証状態を確認
- **ポート分離**: バックエンド(3001)とフロントエンド(8080)で分離

## 🚀 システム起動方法

### 🔥 最初の1回のみ: 初期セットアップ
```bash
cd /Users/x21095xx/個人事業/My-Web-site
./setup.sh
```

### 方法1: 自動起動スクリプト使用（推奨）
```bash
cd /Users/x21095xx/個人事業/My-Web-site
./start-secure.sh
```

### 方法2: 手動起動
```bash
# バックエンド起動
cd backend
source venv/bin/activate  # 仮想環境有効化
python app.py

# フロントエンド起動（別ターミナル）
cd frontend
python3 -m http.server 8080
```

### 🐍 Python仮想環境について
- macOS Sonoma以降では仮想環境が必須
- 初回セットアップで自動的に作成されます
- パッケージは仮想環境内にインストールされ、システムPythonに影響しません

## 👥 ユーザーアカウント

| ユーザー名 | パスワード | 権限 |
|------------|------------|------|
| user1 | password123 | 一般ユーザー |
| user2 | password456 | 一般ユーザー |
| user3 | password789 | 一般ユーザー |

**注意**: 本番環境では必ずパスワードを変更してください。

## 🛡️ セキュリティレベル

### 低リスク環境（現在の設定）
- ✅ 基本認証
- ✅ セッション管理
- ✅ パスワードハッシュ化
- ✅ CSRF対策

### 追加で検討可能な対策

#### 中リスク環境
- 🔄 HTTPS化（SSL証明書）
- 🔄 IPアドレス制限
- 🔄 レート制限（ログイン試行回数制限）
- 🔄 監査ログ

#### 高リスク環境
- 🔄 二要素認証（2FA）
- 🔄 データベース暗号化
- 🔄 VPN必須アクセス
- 🔄 定期的なセキュリティ監査

## 📝 使用方法

1. **システム起動**: `./start-secure.sh` を実行
2. **ブラウザアクセス**: http://localhost:8080
3. **ログイン**: 提供されたユーザー名・パスワードで認証
4. **システム利用**: 通常通り売上データを分析
5. **ログアウト**: 右上のログアウトボタンを使用

## 🔧 カスタマイズ

### ユーザーの追加・変更
`backend/app.py` の `USERS` 辞書を編集:
```python
USERS = {
    'newuser': generate_password_hash('newpassword'),
    # 既存ユーザー...
}
```

### セッション時間の調整
Flaskの設定で `PERMANENT_SESSION_LIFETIME` を調整可能

### ポートの変更
- バックエンド: `app.py` の `port=3001` を変更
- フロントエンド: HTTPサーバーのポート番号を変更

## ⚠️ 注意事項

1. **パスワード管理**: デフォルトパスワードは必ず変更
2. **ネットワーク**: 信頼できるネットワークでのみ使用
3. **アップデート**: 定期的にライブラリの更新を確認
4. **バックアップ**: sales.csvのバックアップを定期的に作成
5. **ログ監視**: 不審なアクセスがないか定期的に確認

## 🆘 トラブルシューティング

### ログインできない
- ユーザー名・パスワードを確認
- ブラウザのCookieをクリア
- バックエンドサーバーが起動しているか確認

### データが表示されない
- sales.csvファイルが存在するか確認
- 認証状態を確認（再ログイン）
- ブラウザの開発者ツールでエラーを確認

### セッションが切れる
- 一定時間経過で自動ログアウト（正常動作）
- 再度ログインしてください
